{% extends "base_layout.html" %}
{% block title %}Manage Parking Spots{% endblock %}

{% block head_extra %}
{{ super() }}
<link rel="stylesheet" href="/static/CSS/parking_spot.css">
<style>
    .spot.future-booked {
        background-color: #9c27b0;
        color: white;
        border: 2px solid #7b1fa2;
    }
    .spot.occupied {
        background-color: #f44336; 
        color: white;
        border: 2px solid #d32f2f;
    }
    .spot.available {
        background-color: #4CAF50; 
        color: white;
        border: 2px solid #388E3C;
    }

    .future-bookings-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
        font-size: 0.9em;
    }
    .future-bookings-table th, .future-bookings-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
    }
    .future-bookings-table th {
        background-color: #f2f2f2;
    }
</style>
{% endblock %}

{% block content %}
{% include "admin_navbar.html" %}

<div class="main-content">
    <div class="container spot-container">
        <h3 class="text-center">View and Edit Parking Spots</h3>
        <p class="text-center mb-3">
            Parking Lot: <strong>{{ lot.primelocation_name }}</strong> (City: {{ lot.city }})
        </p>

        <div class="text-center mb-4">
            <span class="badge bg-primary fs-6 me-3">Total Spots: {{ total_spots_count }}</span>
            <span class="badge bg-success fs-6 me-3">Available: {{ total_spots_count - occupied_physical_spots_count }}</span>
            <span class="badge bg-danger fs-6">Physically Occupied: {{ occupied_physical_spots_count }}</span>
        </div>

        <div class="row">
            <!-- Left: Spots Grid -->
            <div class="col-md-7">
                <div class="spots-grid">
                    {% for spot_data in spots %} 
                    <div class="spot 
                         {% if spot_data.display_status == 'O' %}occupied
                         {% elif spot_data.display_status == 'F' %}future-booked {# New class #}
                         {% else %}available{% endif %}"
                         onclick="showDetails({{ spot_data.spot_id }})"> 
                        {{ spot_data.spot_id }}
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Right: Details Panel -->
            <div class="col-md-5">
                <div class="details-panel" id="details-panel">
                    <h5 class="text-center mb-3">Spot Details</h5>
                    <div id="details-content" class="text-center text-muted">
                        Click a parking spot to view details here.
                    </div>
                </div>
            </div>
        </div>

        <!-- Add New spot button -->
        <div class="text-center mt-4">
            <form action="{{ url_for('add_spot', lot_id=lot.lot_id) }}" method="POST">
                <button type="submit" class="btn btn-dark">+ Add New Spot to this Lot</button>
            </form>
        </div>

        <div class="instructions mt-3">
            <p>✔ Click on a <strong style="color:red;">Red (Occupied)</strong> spot to view current booking details.</p>
            <p>✔ Click on a <strong style="color:#9c27b0;">Purple (Booked for Future)</strong> spot to view upcoming bookings.</p>
            <p>✔ Click on a <strong style="color:green;">Green (Available)</strong> spot to delete it.</p>
        </div>
    </div>
</div>

<script src="/static/js/parking_spot_scripts.js"></script>
{% endblock %}