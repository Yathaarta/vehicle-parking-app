{% extends "base_layout.html" %}

{% block title %}Admin Search - ParkAlot{% endblock %}
{% block meta_description %}Search users and parking lots in ParkAlot.{% endblock %}

{% block head_extra %}
    {{ super() }}
    <link rel="stylesheet" href="/static/css/navbar2.css">
    <style>
        .table-container {
            max-height: 500px; 
            overflow-y: auto;  
            border: 1px solid #ddd;
            background:  rgba(255, 255, 255, 0.9);
            border-radius: 8px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            outline: black solid 1px;
        }
        .table thead th {
            position: sticky;
            top: 0;
            background: #212529; 
            color: white;
            z-index: 2;
        }
        .btn-sm {
            padding: 4px 10px;
            font-size: 14px;
        }
        .card {
            padding: 30px;
            margin-top: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        
    </style>
{% endblock %}

{% block content %}
    <!-- Navbar -->
    {% include "admin_navbar.html" %}

    <!-- Main Content -->
    <div class="hero-section">
        <div class="text-center">
            <h3 class="custom-heading">
                Admin Search
            </h3>
        </div>

        <div class="card">
            <form method="POST" action="{{ url_for('admin_search') }}">
                <div class="mb-3">
                    <label for="search_type" class="form-label">Select Search Type:</label>
                    <select class="form-select" id="search_type" name="search_type" onchange="toggleSearchForms()">
                        <option value="">-- Select --</option>
                        <option value="search_user" {% if search_type == 'search_user' %}selected{% endif %}>Search User</option>
                        <option value="search_parking_lot" {% if search_type == 'search_parking_lot' %}selected{% endif %}>Search Parking Lot</option>
                    </select>
                </div>

                <!-- User Search Form -->
                <div id="user_search_form" style="display: {% if search_type == 'search_user' %}block{% else %}none{% endif %};">
                    <div class="mb-3">
                        <label for="user_email_id" class="form-label">Enter User Email ID:</label>
                        <input type="email" class="form-control" id="user_email_id" name="user_email_id" value="{{ request.form.user_email_id if request.form.user_email_id }}">
                    </div>
                    <div class="mb-3">
                        <label for="user_id" class="form-label">Enter User ID:</label>
                        <input type="number" class="form-control" id="user_id" name="user_id" value="{{ request.form.user_id if request.form.user_id }}">
                    </div>
                    <button type="submit" class="btn btn-dark" name="submit_user_search">Search User</button>
                </div>

                <!-- Parking Lot Search Form -->
                <div id="parking_lot_search_form" style="display: {% if search_type == 'search_parking_lot' %}block{% else %}none{% endif %};">
                    <div class="mb-3">
                        <label for="city" class="form-label">Enter City:</label>
                        <input type="text" class="form-control" id="city" name="city" value="{{ request.form.city if request.form.city }}">
                    </div>
                    <div class="mb-3">
                        <label for="pincode" class="form-label">Enter Pincode:</label>
                        <input type="text" class="form-control" id="pincode" name="pincode" value="{{ request.form.pincode if request.form.pincode }}">
                    </div>
                    <button type="submit" class="btn btn-dark" name="submit_parking_lot_search">Search Parking Lot</button>
                </div>
            </form>
        </div>

        <!-- Display Search Results -->
        <div class="container mt-5">

            {% if user_result %}
                <h4 class="custom-heading">User Details:</h4>
                <div class="table-container mt-3">
                    <table class="table table-striped table-hover bg-white shadow-sm rounded">
                        <thead class="table-dark">
                            <tr>
                                <th scope="col">User ID</th>
                                <th scope="col">Username</th>
                                <th scope="col">Email ID</th>
                                <th scope="col">Is Admin</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>{{ user_result.user_id }}</td>
                                <td>{{ user_result.user_name }}</td>
                                <td>{{ user_result.email_id }}</td>
                                <td>{{ 'Yes' if user_result.is_admin else 'No' }}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            {% endif %}

            {% if parking_lots_result %} 
                <h4 class="custom-heading">Parking Lot Details:</h4>
                <div class="table-container mt-3">
                    <table class="table table-striped table-hover bg-white shadow-sm rounded">
                        <thead class="table-dark">
                            <tr>
                                <th scope="col">Lot ID</th>
                                <th scope="col">Area Type</th>
                                <th scope="col">City</th>
                                <th scope="col">Prime Location</th>
                                <th scope="col">Address</th>
                                <th scope="col">Pincode</th>
                                <th scope="col">Price/hr (â‚¹)</th>
                                <th scope="col">Total Spots</th> 
                                <th scope="col">Physically Occupied</th> 
                                <th scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for lot_stats in parking_lots_result %} 
                            <tr>
                                <td>{{ lot_stats.lot.lot_id }}</td>
                                <td>{{ lot_stats.lot.area_type }}</td>
                                <td>{{ lot_stats.lot.city }}</td>
                                <td>{{ lot_stats.lot.primelocation_name }}</td>
                                <td>{{ lot_stats.lot.address }}</td>
                                <td>{{ lot_stats.lot.pincode }}</td>
                                <td>{{ lot_stats.lot.price_per_hr }}</td>
                                <td>{{ lot_stats.total_spots }}</td> 
                                <td>{{ lot_stats.occupied_physical_spots }}</td> 
                                <td>
                                    <a href="{{ url_for('edit_parking', lot_id=lot_stats.lot.lot_id) }}" class="btn btn-sm btn-primary">Edit</a>
                                    <a href="{{ url_for('parking_spots', lot_id=lot_stats.lot.lot_id) }}" class="btn btn-sm btn-info">Manage</a>
                                    <a href="{{ url_for('delete_parking', lot_id=lot_stats.lot.lot_id) }}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this lot?')">Delete</a>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
        </div>
    </div>

    <script>
        function toggleSearchForms() {
            var searchType = document.getElementById('search_type').value;
            var userForm = document.getElementById('user_search_form');
            var parkingForm = document.getElementById('parking_lot_search_form');

            if (searchType === 'search_user') {
                userForm.style.display = 'block';
                parkingForm.style.display = 'none';
            } else if (searchType === 'search_parking_lot') {
                userForm.style.display = 'none';
                parkingForm.style.display = 'block';
            } else {
                userForm.style.display = 'none';
                parkingForm.style.display = 'none';
            }
        }
        
        document.addEventListener('DOMContentLoaded', toggleSearchForms);
    </script>
{% endblock %}